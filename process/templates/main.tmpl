{{ $path := .Path }}
{{ $imports := .Imports }}
package {{ $path | name }}

import (
	"reflect"

	"kego.io/json"

	{{ if not (eq $path "kego.io/system") }}
		"kego.io/system"
	{{ end }}

	{{ range $importName, $importPath := $imports }}
		{{ import $importName $importPath $path }}
	{{ end }}
)

{{ range $ref, $type := .Types }}
	{{ if and (not $type.Interface) (not $type.IsNativeValue) (not $type.Exclude) }}
		{{ $type | description }}
		type {{ $type.GoName }} struct {
			{{ if not $type.Basic }}
				*{{ reference_id "kego.io/system" "base" $path $imports }}
			{{ end }}
			{{ range $embed := $type.Embed }}
				*{{ $embed.GoReference $path $imports }}
			{{ end }}

			{{ range $fieldName, $field := $type.Fields }}
				{{ $field | description }}
				{{ $fieldName | goname }} {{ gotype $field $path $imports }}
			{{ end }}
		}
	{{ end }}
{{ end }}

func init() {
	{{ range $ref, $type := .Types }}
		{{ if not $type.Interface }}
			{{ reference "kego.io/json" "RegisterType" $path $imports }}({{ $ref.Package | quote }}, {{ $ref.Name | quote }}, reflect.TypeOf(&{{ $type.GoName }}{}))
		{{ end }}
	{{ end }}
}

{{ if not (eq $path "kego.io/system") }}
	var _ system.Nothing
{{ end }}
{{ range $importName, $importPath := $imports }}
	var _ {{ $importName }}.Nothing
{{ end }}

type Nothing struct{}